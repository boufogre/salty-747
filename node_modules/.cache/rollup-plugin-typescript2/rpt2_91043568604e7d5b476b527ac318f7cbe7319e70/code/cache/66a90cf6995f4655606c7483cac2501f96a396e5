{"code":"import { __awaiter } from \"tslib\";\r\nimport { WaypointBuilder } from \"./WaypointBuilder\";\r\n/** A class for syncing a flight plan with the game */\r\nexport class FlightPlanAsoboSync {\r\n    static init() {\r\n        if (!FlightPlanAsoboSync.fpListenerInitialized) {\r\n            RegisterViewListener(\"JS_LISTENER_FLIGHTPLAN\");\r\n            FlightPlanAsoboSync.fpListenerInitialized = true;\r\n        }\r\n    }\r\n    static LoadFromGame(fpln) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            console.log(\"LOAD FPLN\");\r\n            return new Promise((resolve, reject) => {\r\n                FlightPlanAsoboSync.init();\r\n                setTimeout(() => {\r\n                    Coherent.call(\"LOAD_CURRENT_GAME_FLIGHT\");\r\n                    Coherent.call(\"LOAD_CURRENT_ATC_FLIGHTPLAN\");\r\n                    setTimeout(() => {\r\n                        Coherent.call(\"GET_FLIGHTPLAN\").then((data) => __awaiter(this, void 0, void 0, function* () {\r\n                            console.log(\"COHERENT GET_FLIGHTPLAN received\");\r\n                            const isDirectTo = data.isDirectTo;\r\n                            // TODO: talk to matt about dirto\r\n                            if (!isDirectTo) {\r\n                                if (data.waypoints.length === 0) {\r\n                                    resolve();\r\n                                    return;\r\n                                }\r\n                                yield fpln._parentInstrument.facilityLoader.getFacilityRaw(data.waypoints[0].icao, 10000);\r\n                                // set origin\r\n                                yield fpln.setOrigin(data.waypoints[0].icao);\r\n                                // set dest\r\n                                yield fpln.setDestination(data.waypoints[data.waypoints.length - 1].icao);\r\n                                // set route\r\n                                const enrouteStart = (data.departureWaypointsSize == -1) ? 1 : data.departureWaypointsSize;\r\n                                const enroute = data.waypoints.slice(enrouteStart);\r\n                                for (let i = 0; i < enroute.length - 1; i++) {\r\n                                    const wpt = enroute[i];\r\n                                    console.log(wpt.icao);\r\n                                    if (wpt.icao.trim() !== \"\") {\r\n                                        yield fpln.addWaypoint(wpt.icao);\r\n                                    }\r\n                                    else if (wpt.ident === \"Custom\") {\r\n                                        const cwpt = WaypointBuilder.fromCoordinates(\"CUST\" + i, wpt.lla, fpln._parentInstrument);\r\n                                        yield fpln.addUserWaypoint(cwpt);\r\n                                    }\r\n                                }\r\n                                // set departure\r\n                                //  rwy index\r\n                                yield fpln.setOriginRunwayIndex(data.originRunwayIndex);\r\n                                //  proc index\r\n                                yield fpln.setDepartureProcIndex(data.departureProcIndex);\r\n                                yield fpln.setDepartureRunwayIndex(data.departureRunwayIndex);\r\n                                //  enroutetrans index\r\n                                yield fpln.setDepartureEnRouteTransitionIndex(data.departureEnRouteTransitionIndex);\r\n                                // set arrival\r\n                                //  arrivalproc index\r\n                                yield fpln.setArrivalProcIndex(data.arrivalProcIndex);\r\n                                //  arrivaltrans index\r\n                                yield fpln.setArrivalEnRouteTransitionIndex(data.arrivalEnRouteTransitionIndex);\r\n                                // set approach\r\n                                //  approach index\r\n                                yield fpln.setApproachIndex(data.approachIndex);\r\n                                //  approachtrans index\r\n                                yield fpln.setApproachTransitionIndex(data.approachTransitionIndex);\r\n                                this.fpChecksum = fpln.getCurrentFlightPlan().checksum;\r\n                                resolve();\r\n                            }\r\n                        }));\r\n                    }, 500);\r\n                }, 200);\r\n            });\r\n        });\r\n    }\r\n    static SaveToGame(fpln) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // eslint-disable-next-line no-async-promise-executor\r\n            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\r\n                FlightPlanAsoboSync.init();\r\n                const plan = fpln.getCurrentFlightPlan();\r\n                if (WTDataStore.get('WT_CJ4_FPSYNC', 0) !== 0 && (plan.checksum !== this.fpChecksum)) {\r\n                    // await Coherent.call(\"CREATE_NEW_FLIGHTPLAN\");\r\n                    yield Coherent.call(\"SET_CURRENT_FLIGHTPLAN_INDEX\", 0).catch(console.log);\r\n                    yield Coherent.call(\"CLEAR_CURRENT_FLIGHT_PLAN\").catch(console.log);\r\n                    if (plan.hasOrigin && plan.hasDestination) {\r\n                        if (plan.hasOrigin) {\r\n                            yield Coherent.call(\"SET_ORIGIN\", plan.originAirfield.icao, false);\r\n                        }\r\n                        if (plan.hasDestination) {\r\n                            yield Coherent.call(\"SET_DESTINATION\", plan.destinationAirfield.icao, false);\r\n                        }\r\n                        let coIndex = 1;\r\n                        for (let i = 0; i < plan.enroute.waypoints.length; i++) {\r\n                            const wpt = plan.enroute.waypoints[i];\r\n                            if (wpt.icao.trim() !== \"\") {\r\n                                yield Coherent.call(\"ADD_WAYPOINT\", wpt.icao, coIndex, false);\r\n                                coIndex++;\r\n                            }\r\n                        }\r\n                        yield Coherent.call(\"SET_ORIGIN_RUNWAY_INDEX\", plan.procedureDetails.originRunwayIndex).catch(console.log);\r\n                        yield Coherent.call(\"SET_DEPARTURE_RUNWAY_INDEX\", plan.procedureDetails.departureRunwayIndex);\r\n                        yield Coherent.call(\"SET_DEPARTURE_PROC_INDEX\", plan.procedureDetails.departureIndex);\r\n                        yield Coherent.call(\"SET_DEPARTURE_ENROUTE_TRANSITION_INDEX\", plan.procedureDetails.departureTransitionIndex);\r\n                        yield Coherent.call(\"SET_ARRIVAL_RUNWAY_INDEX\", plan.procedureDetails.arrivalRunwayIndex);\r\n                        yield Coherent.call(\"SET_ARRIVAL_PROC_INDEX\", plan.procedureDetails.arrivalIndex);\r\n                        yield Coherent.call(\"SET_ARRIVAL_ENROUTE_TRANSITION_INDEX\", plan.procedureDetails.arrivalTransitionIndex);\r\n                        yield Coherent.call(\"SET_APPROACH_INDEX\", plan.procedureDetails.approachIndex).then(() => {\r\n                            Coherent.call(\"SET_APPROACH_TRANSITION_INDEX\", plan.procedureDetails.approachTransitionIndex);\r\n                        });\r\n                    }\r\n                    this.fpChecksum = plan.checksum;\r\n                }\r\n                Coherent.call(\"RECOMPUTE_ACTIVE_WAYPOINT_INDEX\");\r\n            }));\r\n        });\r\n    }\r\n}\r\nFlightPlanAsoboSync.fpChecksum = 0;\r\nFlightPlanAsoboSync.fpListenerInitialized = false;\r\n//# sourceMappingURL=FlightPlanAsoboSync.js.map","references":["D:/Documents/GitHub/boufogre/salty-747/src/fpm/src/flightplanning/FlightPlanManager.ts","D:/Documents/GitHub/boufogre/salty-747/src/fpm/src/flightplanning/WaypointBuilder.ts"],"map":"{\"version\":3,\"file\":\"FlightPlanAsoboSync.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/fpm/src/flightplanning/FlightPlanAsoboSync.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"D:/Documents/GitHub/boufogre/salty-747/src/fpm/dist/types/flightplanning/FlightPlanAsoboSync.d.ts","writeByteOrderMark":false,"text":"import { FlightPlanManager } from \"./FlightPlanManager\";\r\n/** A class for syncing a flight plan with the game */\r\nexport declare class FlightPlanAsoboSync {\r\n    static fpChecksum: number;\r\n    static fpListenerInitialized: boolean;\r\n    static init(): void;\r\n    static LoadFromGame(fpln: FlightPlanManager): Promise<void>;\r\n    static SaveToGame(fpln: FlightPlanManager): Promise<void>;\r\n}\r\n"}}
